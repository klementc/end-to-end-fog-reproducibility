# Reproducible end-to-end microservice simulation in the fog

This repository contains the data used to run the experiments and reproduce the results of our paper “Studying the end-to-end performance, energy consumption, and carbon footprint of fog applications”.

# Install dependencies

## SimGrid

SimGrid is used to run all simulations. It contains all the implemented models we talk about in the paper.

To install SimGrid in the root of the project, use the following shell script.

```bash
# the directory used to install the dependencies
currDir=${PWD}
depRepo=${PWD}/deps/
mkdir -p ${depRepo}
cd ${depRepo}


# Install SimGrid into ${root}/simgrid: (we use a forked version for an additional Wi-Fi power model function)
git clone https://framagit.org/klement/simgrid.git
cd simgrid
git checkout wifi_clean
mkdir build && cd build
cmake ..
make -j$(nproc)
cd ${root}
```

## YAFS

**Only useful for simulator comparison**

Download and install YAFS from [github YAFS](https://github.com/acsicuib/YAFS)

Commit used: 5a48b7ca6d5293a3d371a5992e4250116bf1b11c

## NS-3

**Only useful for simulator comparison**
Install ns-3 version 3.39 [link](https://www.nsnam.org/releases/ns-3-39/) and set the path to your ns-3 in the ns-3 Makefiles and launcher if necessary.

## IFogSim

**Only useful for simulator comparison**

You can directly use the jar files provided in the repository.

Generated from [github](https://github.com/Cloudslab/iFogSim)

Version 2.0.0, commit 643c433b9d6c9f031a2e31f129f2b2c6c7fae835

# Run the simulators comparison

See [./simulators_comparison/Readme.md](./simulators_comparison/Readme.md)

# Run the end-to-end experiments

`Warning: The logs generated by the experiments take several GB of disk space because of the number of monitored metrics, reduce the number of scenarios if required`

To run the experiments, we run [energy_analysis/launchG5KCloud.sh](energy_analysis/launchG5KCloud.sh) and [energy_analysis/launchG5KFog.sh](energy_analysis/launchG5KFog.sh) for the cloud and fog scenarios respectively. You can modify these scripts to run:

- Only the simulations without the processing of logs by commenting the lines with the `bash analyse.sh` and `Rscript` commands
- Only the analysis by commenting the lines with `${buildDir}/energy_analysis/${appType[$appT]} [...] > out_${suffix}_{tcp,udp} 2>&1` that launch the simulations with SimGrid

Alternatively, you can modify the parameters of the scenarios with variables `nbHops` for the number of network hops between the fog and the cloud datacenter, `netSize` for the size of network requests, and `execR` for the execution ratio (see paper). Some of these options may require manual modifications of the platform and configuration files.

# Results analysis

To run the analysis of the simulation logs, you need to have R installed on your system. We use the following packages to produce our visualizations:
```
plyr,dplyr,ggplot2,tidyr,gridExtra,ggpubr,plotly,ggquadrilateral,cowplot,ggsci,reshape2,stringr
```

The script we use is located under [energy_analysis/genPlot.R](energy_analysis/genPlot.R). This script produces the plots in [energy_analysis/respdf](energy_analysis/respdf) as a pdf files for each scenario and [energy_analysis/visualize](energy_analysis/visualize) for the web viewer.